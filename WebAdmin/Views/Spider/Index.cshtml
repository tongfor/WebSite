
@{
    ViewData["Title"] = "网页采集";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>互联网信息采集</h2>
<div id="gather-list" class="text-center">
    <ul>
        <li class="floatleft">
            <input value="采集市经委信息" id="g_cdgy_classId_2" data-classId="2" data-siteKey="cdgy" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_cdgy_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集省经委信息" id="g_jxt_classId_2" data-classId="2" data-siteKey="jxt" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jxt_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集市科技局信息" id="g_cdst_classId_2" data-classId="2" data-siteKey="cdst" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_cdst_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集省科技厅信息" id="g_kjt_classId_2" data-classId="2" data-siteKey="kjt" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_kjt_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集高新区信息" id="g_cdht_classId_2" data-classId="2" data-siteKey="cdht" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_cdht_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集天府新区信息" id="g_cdtf_classId_2" data-classId="2" data-siteKey="cdtf" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_cdtf_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft" style="height:80px;">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft" style="height:80px;">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft" style="height:80px;">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft" style="height:80px;">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft" style="height:80px;">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
        <li class="floatleft">
            <input value="采集金牛区信息" id="g_jnq_classId_2" data-classId="2" data-siteKey="jnq" type="button" class="gatherbtn" />
            <br />
            <span id="submitloading_jnq_classId_2" style="display:none;text-align:center;">采集开始<br /><img src="~/images/loading.gif" /></span>
        </li>
    </ul>
</div>
<div class="clearfix"></div>
@section PageSpecificJavascriptIncludes{
    <script>
        $(function () {
            $(".gatherbtn").click(function (e) {
                var obj = $(e.target);
                var classId = obj.attr("data-classId");
                var siteKey = obj.attr("data-siteKey")
                var loadingId = "submitloading_" + siteKey + "_" + "classId" + "_" + classId;
                var paras = {
                    "siteKey": siteKey,
                    "pageStartNo": 1,
                    "pageEndNo": 2,
                    "classId": classId
                };
                $.ajax({
                    url: "/Spider/GatherWebsite",
                    type: "POST",
                    data: paras,
                    timeout: 3000000, //超时时间设置，单位毫秒
                    beforeSend: function () {
                        obj.attr("disabled", "true");//防止连击
                        $("#" + loadingId).show();
                    },
                    success: function (result, status) {
                        if (result && "success" === status && 0 === result.status) {
                            alert(result.msg);
                            window.top.location.reload();
                            window.top.tb_remove();
                        }
                        $("#" + loadingId).hide();
                        obj.removeAttr("disabled");
                    },
                    error: function (xhr, status, error) {
                        $("#" + loadingId).hide();
                        obj.removeAttr("disabled");
                        document.write(xhr.responseText);
                        console.log(xhr);
                        console.log(status);
                        console.log(error);
                    },
                    complete: function (XMLHttpRequest, status) { //请求完成后最终执行参数
                        if ('timeout' === status) {//超时,status还有success,error等值的情况
                            ajaxTimeoutTest.abort();
                            console.log("超时");
                        }
                    }
                });
                return false;
            });

            //$("#g_jxt_classId_3").click(function () {
            //    $.ajax({
            //        url: "/Spider/GatherjxtWebsite?pageStartNo=1&pageEndNo=67&classId=2",
            //        type: "POST",
            //        beforeSend: function () {
            //            $("#g_jxt_classId_3").attr("disabled", "true");//防止连击
            //            $("#submitloading_jxt_classId_3").show();
            //        },
            //        success: function (result, status) {
            //            if (result && "success" === status && 0 === result.status) {
            //                alert(result.msg);
            //                window.top.location.reload();
            //                window.top.tb_remove();
            //            }
            //            $("#submitloading_jxt_classId_3").hide();
            //            $("#g_jxt_classId_3").removeAttr("disabled");
            //        },
            //        error: function (xhr, status, error) {
            //            $("#submitloading_jxt_classId_3").hide();
            //            $("#g_jxt_classId_3").removeAttr("disabled");
            //            document.write(xhr.responseText);
            //            console.log(xhr);
            //            console.log(status);
            //            console.log(error);
            //        }
            //    });
            //    return false;
            //});
        });
    </script>
}



