var siteGather=function(){function u(n,t){var i=new Date(n),r,u;return!i||!t||0===t.length||isNaN(t)?!1:(r=new Date,u=r.getTime()-i.getTime(),u<=t*864e5)}var n=[{id:1,siteName:"市经委",siteKey:"cdgy",startPageNo:1,endPageNo:2},{id:2,siteName:"省经信厅",siteKey:"jxt",startPageNo:1,endPageNo:2},{id:3,siteName:"市科技局",siteKey:"cdst",startPageNo:1,endPageNo:2},{id:4,siteName:"省科技厅",siteKey:"kjt",startPageNo:1,endPageNo:2},{id:5,siteName:"高新区",siteKey:"cdht",startPageNo:1,endPageNo:2},{id:6,siteName:"天府新区",siteKey:"cdtf",startPageNo:1,endPageNo:2},{id:7,siteName:"金牛区",siteKey:"jnq"},{id:8,siteName:"锦江区",siteKey:"jjq",startPageNo:1,endPageNo:2},{id:9,siteName:"武侯区经科局",siteKey:"whqjkj",startPageNo:1,endPageNo:2},{id:10,siteName:"青羊区科经局",siteKey:"qyqkjj",startPageNo:1,endPageNo:2},{id:11,siteName:"成华区经科局",siteKey:"chqjkj",startPageNo:1,endPageNo:2},{id:12,siteName:"龙泉驿区",siteKey:"lqyq",startPageNo:1,endPageNo:100},{id:13,siteName:"青白江区科经局",siteKey:"qbjqkjj",startPageNo:1,endPageNo:2}],t=$("#gather-list"),i=function(){var i,r;t.empty();i="<ul>\n";for(r in n)i+='    <li class="floatleft">\n',i+='<input value="采集'+n[r].siteName,i+='信息" id="g_'+n[r].siteKey+'_classId_2" data-classId="2"',i+='data-siteKey="'+n[r].siteKey,i+='" data-startPageNo="'+n[r].startPageNo,i+='" data-endPageNo="'+n[r].endPageNo,i+='" type = "button" class="gatherbtn" />\n',i+="<br />\n",i+='<span id="submitloading_'+n[r].siteKey,i+='_classId_2" style="display:none;text-align:center;">采集开始',i+='<br /><img src="/images/loading.gif" /><\/span >\n';i+="<\/ul>\n";t.append(i)},r=function(n,t){var f,i,r;if(n){if(f=$("."+n),i="",t&&t.gatheredArticleList){i+="<p>在"+t.gatherTime;i+="从"+t.siteName+"采集了"+t.gatheredArticleList.length+"条信息:<\/p>\n";for(r in t.gatheredArticleList)i+='<p><a href="'+t.resultShowDomainName,i+="/Article/Details-"+t.gatheredArticleList[r].id,i+='.html" title="'+t.gatheredArticleList[r].title,i+='" target="_blank">'+t.gatheredArticleList[r].title,i+="<\/a>",i+=u(t.gatheredArticleList[r].addTime,3)?'[<span class="text-error">'+t.gatheredArticleList[r].addTime+"<\/span>]":"[<span>"+t.gatheredArticleList[r].addTime+"<\/span>]",i+='&nbsp; <a href="'+t.gatheredArticleList[r].gatherurl,i+='" title="原文地址" target="_blank">原文地址<\/a>',i+="<\/p>\n"}(0===f.html().length||"&nbsp;"===f.html())&&(i="<p>采集结果如下：<\/p>\n"+i);f.append(i);f.scrollTop(f.prop("scrollHeight"))}};return{menuData:n,gatherMenuInit:i,showGatherResult:r}}();$(function(){siteGather.gatherMenuInit();$(".gatherbtn").click(function(n){var t=$(n.target),r=t.attr("data-classId"),u=t.attr("data-siteKey"),i="submitloading_"+u+"_classId_"+r,f={siteKey:u,pageStartNo:t.attr("data-startPageNo"),pageEndNo:t.attr("data-endPageNo"),classId:r};return $.ajax({url:"/Spider/GatherWebsite",type:"POST",data:f,timeout:3e6,beforeSend:function(){t.attr("disabled","true");$("#"+i).show()},success:function(n,r){n&&"success"===r&&0===n.status?siteGather.showGatherResult("gather-result",n.data):n&&1===n.status&&n.msg&&alert(n.msg);$("#"+i).hide();t.removeAttr("disabled")},error:function(n,r,u){$("#"+i).hide();t.removeAttr("disabled");document.write(n.responseText);console.log(n);console.log(r);console.log(u)},complete:function(n,t){"timeout"===t&&(ajaxTimeoutTest.abort(),console.log("超时"))}}),!1})});